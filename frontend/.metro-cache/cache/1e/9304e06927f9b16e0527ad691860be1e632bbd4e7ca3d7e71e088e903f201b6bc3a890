{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":52,"index":105}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"../store/authStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":106},"end":{"line":3,"column":50,"index":156}}],"key":"/4BDl/hqolvw7T4CXD8jWAtZK4M=","exportNames":["*"],"imports":1}},{"name":"../services/notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":157},"end":{"line":9,"column":35,"index":312}}],"key":"PilFUkBfYpg1cVGLNRiWDw/oULQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  exports.usePushNotifications = usePushNotifications;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _expoNotifications = require(_dependencyMap[1], \"expo-notifications\");\n  var Notifications = _interopNamespace(_expoNotifications);\n  var _storeAuthStore = require(_dependencyMap[2], \"../store/authStore\");\n  var _servicesNotifications = require(_dependencyMap[3], \"../services/notifications\");\n  function usePushNotifications() {\n    const {\n      user,\n      isAuthenticated\n    } = (0, _storeAuthStore.useAuthStore)();\n    const [state, setState] = (0, _react.useState)({\n      expoPushToken: null,\n      notification: null,\n      loading: true,\n      error: null\n    });\n    const notificationListener = (0, _react.useRef)(null);\n    const responseListener = (0, _react.useRef)(null);\n    (0, _react.useEffect)(() => {\n      // Only register if user is logged in\n      if (!user || !isAuthenticated) {\n        setState(prev => ({\n          ...prev,\n          loading: false\n        }));\n        return;\n      }\n      const setupNotifications = async () => {\n        try {\n          // Register for push notifications\n          const token = await (0, _servicesNotifications.registerForPushNotificationsAsync)();\n          if (token) {\n            setState(prev => ({\n              ...prev,\n              expoPushToken: token\n            }));\n\n            // Register token with backend\n            await (0, _servicesNotifications.registerPushToken)(token);\n          }\n          setState(prev => ({\n            ...prev,\n            loading: false\n          }));\n        } catch (error) {\n          console.error('Error setting up notifications:', error);\n          setState(prev => ({\n            ...prev,\n            error: error instanceof Error ? error.message : 'Unknown error',\n            loading: false\n          }));\n        }\n      };\n      setupNotifications();\n\n      // Listen for incoming notifications when app is in foreground\n      notificationListener.current = Notifications.addNotificationReceivedListener(notification => {\n        console.log('Notification received:', notification);\n        setState(prev => ({\n          ...prev,\n          notification\n        }));\n      });\n\n      // Listen for notification responses (when user taps notification)\n      responseListener.current = Notifications.addNotificationResponseReceivedListener(response => {\n        (0, _servicesNotifications.handleNotificationResponse)(response);\n      });\n      return () => {\n        notificationListener.current?.remove();\n        responseListener.current?.remove();\n      };\n    }, [user, isAuthenticated]);\n\n    // Cleanup on logout\n    const cleanup = async () => {\n      try {\n        await (0, _servicesNotifications.unregisterPushToken)();\n        setState({\n          expoPushToken: null,\n          notification: null,\n          loading: false,\n          error: null\n        });\n      } catch (error) {\n        console.error('Error cleaning up notifications:', error);\n      }\n    };\n    return {\n      ...state,\n      cleanup\n    };\n  }\n});","lineCount":116,"map":[[22,2,18,0,"exports"],[22,9,18,0],[22,10,18,0,"usePushNotifications"],[22,30,18,0],[22,33,18,0,"usePushNotifications"],[22,53,18,0],[23,2,1,0],[23,6,1,0,"_react"],[23,12,1,0],[23,15,1,0,"require"],[23,22,1,0],[23,23,1,0,"_dependencyMap"],[23,37,1,0],[24,2,2,0],[24,6,2,0,"_expoNotifications"],[24,24,2,0],[24,27,2,0,"require"],[24,34,2,0],[24,35,2,0,"_dependencyMap"],[24,49,2,0],[25,2,2,0],[25,6,2,0,"Notifications"],[25,19,2,0],[25,22,2,0,"_interopNamespace"],[25,39,2,0],[25,40,2,0,"_expoNotifications"],[25,58,2,0],[26,2,3,0],[26,6,3,0,"_storeAuthStore"],[26,21,3,0],[26,24,3,0,"require"],[26,31,3,0],[26,32,3,0,"_dependencyMap"],[26,46,3,0],[27,2,4,0],[27,6,4,0,"_servicesNotifications"],[27,28,4,0],[27,31,4,0,"require"],[27,38,4,0],[27,39,4,0,"_dependencyMap"],[27,53,4,0],[28,2,18,7],[28,11,18,16,"usePushNotifications"],[28,31,18,36,"usePushNotifications"],[28,32,18,36],[28,34,18,39],[29,4,19,2],[29,10,19,8],[30,6,19,10,"user"],[30,10,19,14],[31,6,19,16,"isAuthenticated"],[32,4,19,32],[32,5,19,33],[32,8,19,36],[32,12,19,36,"useAuthStore"],[32,27,19,48],[32,28,19,48,"useAuthStore"],[32,40,19,48],[32,42,19,49],[32,43,19,50],[33,4,20,2],[33,10,20,8],[33,11,20,9,"state"],[33,16,20,14],[33,18,20,16,"setState"],[33,26,20,24],[33,27,20,25],[33,30,20,28],[33,34,20,28,"useState"],[33,40,20,36],[33,41,20,36,"useState"],[33,49,20,36],[33,51,20,60],[34,6,21,4,"expoPushToken"],[34,19,21,17],[34,21,21,19],[34,25,21,23],[35,6,22,4,"notification"],[35,18,22,16],[35,20,22,18],[35,24,22,22],[36,6,23,4,"loading"],[36,13,23,11],[36,15,23,13],[36,19,23,17],[37,6,24,4,"error"],[37,11,24,9],[37,13,24,11],[38,4,25,2],[38,5,25,3],[38,6,25,4],[39,4,27,2],[39,10,27,8,"notificationListener"],[39,30,27,28],[39,33,27,31],[39,37,27,31,"useRef"],[39,43,27,37],[39,44,27,37,"useRef"],[39,50,27,37],[39,52,27,73],[39,56,27,77],[39,57,27,78],[40,4,28,2],[40,10,28,8,"responseListener"],[40,26,28,24],[40,29,28,27],[40,33,28,27,"useRef"],[40,39,28,33],[40,40,28,33,"useRef"],[40,46,28,33],[40,48,28,69],[40,52,28,73],[40,53,28,74],[41,4,30,2],[41,8,30,2,"useEffect"],[41,14,30,11],[41,15,30,11,"useEffect"],[41,24,30,11],[41,26,30,12],[41,32,30,18],[42,6,31,4],[43,6,32,4],[43,10,32,8],[43,11,32,9,"user"],[43,15,32,13],[43,19,32,17],[43,20,32,18,"isAuthenticated"],[43,35,32,33],[43,37,32,35],[44,8,33,6,"setState"],[44,16,33,14],[44,17,33,15,"prev"],[44,21,33,19],[44,26,33,24],[45,10,33,26],[45,13,33,29,"prev"],[45,17,33,33],[46,10,33,35,"loading"],[46,17,33,42],[46,19,33,44],[47,8,33,50],[47,9,33,51],[47,10,33,52],[47,11,33,53],[48,8,34,6],[49,6,35,4],[50,6,37,4],[50,12,37,10,"setupNotifications"],[50,30,37,28],[50,33,37,31],[50,39,37,31,"setupNotifications"],[50,40,37,31],[50,45,37,43],[51,8,38,6],[51,12,38,10],[52,10,39,8],[53,10,40,8],[53,16,40,14,"token"],[53,21,40,19],[53,24,40,22],[53,30,40,28],[53,34,40,28,"registerForPushNotificationsAsync"],[53,56,40,61],[53,57,40,61,"registerForPushNotificationsAsync"],[53,90,40,61],[53,92,40,62],[53,93,40,63],[54,10,42,8],[54,14,42,12,"token"],[54,19,42,17],[54,21,42,19],[55,12,43,10,"setState"],[55,20,43,18],[55,21,43,19,"prev"],[55,25,43,23],[55,30,43,28],[56,14,43,30],[56,17,43,33,"prev"],[56,21,43,37],[57,14,43,39,"expoPushToken"],[57,27,43,52],[57,29,43,54,"token"],[58,12,43,60],[58,13,43,61],[58,14,43,62],[58,15,43,63],[60,12,45,10],[61,12,46,10],[61,18,46,16],[61,22,46,16,"registerPushToken"],[61,44,46,33],[61,45,46,33,"registerPushToken"],[61,62,46,33],[61,64,46,34,"token"],[61,69,46,39],[61,70,46,40],[62,10,47,8],[63,10,49,8,"setState"],[63,18,49,16],[63,19,49,17,"prev"],[63,23,49,21],[63,28,49,26],[64,12,49,28],[64,15,49,31,"prev"],[64,19,49,35],[65,12,49,37,"loading"],[65,19,49,44],[65,21,49,46],[66,10,49,52],[66,11,49,53],[66,12,49,54],[66,13,49,55],[67,8,50,6],[67,9,50,7],[67,10,50,8],[67,17,50,15,"error"],[67,22,50,20],[67,24,50,22],[68,10,51,8,"console"],[68,17,51,15],[68,18,51,16,"error"],[68,23,51,21],[68,24,51,22],[68,57,51,55],[68,59,51,57,"error"],[68,64,51,62],[68,65,51,63],[69,10,52,8,"setState"],[69,18,52,16],[69,19,52,17,"prev"],[69,23,52,21],[69,28,52,26],[70,12,53,10],[70,15,53,13,"prev"],[70,19,53,17],[71,12,54,10,"error"],[71,17,54,15],[71,19,54,17,"error"],[71,24,54,22],[71,36,54,34,"Error"],[71,41,54,39],[71,44,54,42,"error"],[71,49,54,47],[71,50,54,48,"message"],[71,57,54,55],[71,60,54,58],[71,75,54,73],[72,12,55,10,"loading"],[72,19,55,17],[72,21,55,19],[73,10,56,8],[73,11,56,9],[73,12,56,10],[73,13,56,11],[74,8,57,6],[75,6,58,4],[75,7,58,5],[76,6,60,4,"setupNotifications"],[76,24,60,22],[76,25,60,23],[76,26,60,24],[78,6,62,4],[79,6,63,4,"notificationListener"],[79,26,63,24],[79,27,63,25,"current"],[79,34,63,32],[79,37,63,35,"Notifications"],[79,50,63,48],[79,51,63,49,"addNotificationReceivedListener"],[79,82,63,80],[79,83,64,7,"notification"],[79,95,64,19],[79,99,64,24],[80,8,65,8,"console"],[80,15,65,15],[80,16,65,16,"log"],[80,19,65,19],[80,20,65,20],[80,44,65,44],[80,46,65,46,"notification"],[80,58,65,58],[80,59,65,59],[81,8,66,8,"setState"],[81,16,66,16],[81,17,66,17,"prev"],[81,21,66,21],[81,26,66,26],[82,10,66,28],[82,13,66,31,"prev"],[82,17,66,35],[83,10,66,37,"notification"],[84,8,66,50],[84,9,66,51],[84,10,66,52],[84,11,66,53],[85,6,67,6],[85,7,68,4],[85,8,68,5],[87,6,70,4],[88,6,71,4,"responseListener"],[88,22,71,20],[88,23,71,21,"current"],[88,30,71,28],[88,33,71,31,"Notifications"],[88,46,71,44],[88,47,71,45,"addNotificationResponseReceivedListener"],[88,86,71,84],[88,87,72,7,"response"],[88,95,72,15],[88,99,72,20],[89,8,73,8],[89,12,73,8,"handleNotificationResponse"],[89,34,73,34],[89,35,73,34,"handleNotificationResponse"],[89,61,73,34],[89,63,73,35,"response"],[89,71,73,43],[89,72,73,44],[90,6,74,6],[90,7,75,4],[90,8,75,5],[91,6,77,4],[91,13,77,11],[91,19,77,17],[92,8,78,6,"notificationListener"],[92,28,78,26],[92,29,78,27,"current"],[92,36,78,34],[92,38,78,36,"remove"],[92,44,78,42],[92,45,78,43],[92,46,78,44],[93,8,79,6,"responseListener"],[93,24,79,22],[93,25,79,23,"current"],[93,32,79,30],[93,34,79,32,"remove"],[93,40,79,38],[93,41,79,39],[93,42,79,40],[94,6,80,4],[94,7,80,5],[95,4,81,2],[95,5,81,3],[95,7,81,5],[95,8,81,6,"user"],[95,12,81,10],[95,14,81,12,"isAuthenticated"],[95,29,81,27],[95,30,81,28],[95,31,81,29],[97,4,83,2],[98,4,84,2],[98,10,84,8,"cleanup"],[98,17,84,15],[98,20,84,18],[98,26,84,18,"cleanup"],[98,27,84,18],[98,32,84,30],[99,6,85,4],[99,10,85,8],[100,8,86,6],[100,14,86,12],[100,18,86,12,"unregisterPushToken"],[100,40,86,31],[100,41,86,31,"unregisterPushToken"],[100,60,86,31],[100,62,86,32],[100,63,86,33],[101,8,87,6,"setState"],[101,16,87,14],[101,17,87,15],[102,10,88,8,"expoPushToken"],[102,23,88,21],[102,25,88,23],[102,29,88,27],[103,10,89,8,"notification"],[103,22,89,20],[103,24,89,22],[103,28,89,26],[104,10,90,8,"loading"],[104,17,90,15],[104,19,90,17],[104,24,90,22],[105,10,91,8,"error"],[105,15,91,13],[105,17,91,15],[106,8,92,6],[106,9,92,7],[106,10,92,8],[107,6,93,4],[107,7,93,5],[107,8,93,6],[107,15,93,13,"error"],[107,20,93,18],[107,22,93,20],[108,8,94,6,"console"],[108,15,94,13],[108,16,94,14,"error"],[108,21,94,19],[108,22,94,20],[108,56,94,54],[108,58,94,56,"error"],[108,63,94,61],[108,64,94,62],[109,6,95,4],[110,4,96,2],[110,5,96,3],[111,4,98,2],[111,11,98,9],[112,6,99,4],[112,9,99,7,"state"],[112,14,99,12],[113,6,100,4,"cleanup"],[114,4,101,2],[114,5,101,3],[115,2,102,0],[116,0,102,1],[116,3]],"functionMap":{"names":["<global>","usePushNotifications","useEffect$argument_0","setState$argument_0","setupNotifications","Notifications.addNotificationReceivedListener$argument_0","Notifications.addNotificationResponseReceivedListener$argument_0","<anonymous>","cleanup"],"mappings":"AAA;OCiB;YCY;eCG,qCD;+BEI;mBDM,2CC;iBDM,qCC;iBDG;UCI;KFE;MGM;iBFE,mCE;OHC;MIK;OJE;WKG;KLG;GDC;kBOG;GPY;CDM"},"hasCjsExports":false},"type":"js/module"}]}