{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":52,"index":105}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"../store/authStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":106},"end":{"line":3,"column":50,"index":156}}],"key":"/4BDl/hqolvw7T4CXD8jWAtZK4M=","exportNames":["*"],"imports":1}},{"name":"../services/notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":157},"end":{"line":9,"column":35,"index":312}}],"key":"PilFUkBfYpg1cVGLNRiWDw/oULQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  exports.usePushNotifications = usePushNotifications;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _expoNotifications = require(_dependencyMap[1], \"expo-notifications\");\n  var Notifications = _interopNamespace(_expoNotifications);\n  var _storeAuthStore = require(_dependencyMap[2], \"../store/authStore\");\n  var _servicesNotifications = require(_dependencyMap[3], \"../services/notifications\");\n  function usePushNotifications() {\n    _s();\n    const {\n      user,\n      isAuthenticated\n    } = (0, _storeAuthStore.useAuthStore)();\n    const [state, setState] = (0, _react.useState)({\n      expoPushToken: null,\n      notification: null,\n      loading: true,\n      error: null\n    });\n    const notificationListener = (0, _react.useRef)(null);\n    const responseListener = (0, _react.useRef)(null);\n    (0, _react.useEffect)(() => {\n      // Only register if user is logged in\n      if (!user || !isAuthenticated) {\n        setState(prev => ({\n          ...prev,\n          loading: false\n        }));\n        return;\n      }\n      const setupNotifications = async () => {\n        try {\n          // Register for push notifications\n          const token = await (0, _servicesNotifications.registerForPushNotificationsAsync)();\n          if (token) {\n            setState(prev => ({\n              ...prev,\n              expoPushToken: token\n            }));\n\n            // Register token with backend\n            await (0, _servicesNotifications.registerPushToken)(token);\n          }\n          setState(prev => ({\n            ...prev,\n            loading: false\n          }));\n        } catch (error) {\n          console.error('Error setting up notifications:', error);\n          setState(prev => ({\n            ...prev,\n            error: error instanceof Error ? error.message : 'Unknown error',\n            loading: false\n          }));\n        }\n      };\n      setupNotifications();\n\n      // Listen for incoming notifications when app is in foreground\n      notificationListener.current = Notifications.addNotificationReceivedListener(notification => {\n        console.log('Notification received:', notification);\n        setState(prev => ({\n          ...prev,\n          notification\n        }));\n      });\n\n      // Listen for notification responses (when user taps notification)\n      responseListener.current = Notifications.addNotificationResponseReceivedListener(response => {\n        (0, _servicesNotifications.handleNotificationResponse)(response);\n      });\n      return () => {\n        notificationListener.current?.remove();\n        responseListener.current?.remove();\n      };\n    }, [user, isAuthenticated]);\n\n    // Cleanup on logout\n    const cleanup = async () => {\n      try {\n        await (0, _servicesNotifications.unregisterPushToken)();\n        setState({\n          expoPushToken: null,\n          notification: null,\n          loading: false,\n          error: null\n        });\n      } catch (error) {\n        console.error('Error cleaning up notifications:', error);\n      }\n    };\n    return {\n      ...state,\n      cleanup\n    };\n  }\n  _s(usePushNotifications, \"dZ4yWeGuIjl/unq3KSdDBRrQ2ro=\", false, function () {\n    return [_storeAuthStore.useAuthStore];\n  });\n});","lineCount":121,"map":[[23,2,18,0,"exports"],[23,9,18,0],[23,10,18,0,"usePushNotifications"],[23,30,18,0],[23,33,18,0,"usePushNotifications"],[23,53,18,0],[24,2,1,0],[24,6,1,0,"_react"],[24,12,1,0],[24,15,1,0,"require"],[24,22,1,0],[24,23,1,0,"_dependencyMap"],[24,37,1,0],[25,2,2,0],[25,6,2,0,"_expoNotifications"],[25,24,2,0],[25,27,2,0,"require"],[25,34,2,0],[25,35,2,0,"_dependencyMap"],[25,49,2,0],[26,2,2,0],[26,6,2,0,"Notifications"],[26,19,2,0],[26,22,2,0,"_interopNamespace"],[26,39,2,0],[26,40,2,0,"_expoNotifications"],[26,58,2,0],[27,2,3,0],[27,6,3,0,"_storeAuthStore"],[27,21,3,0],[27,24,3,0,"require"],[27,31,3,0],[27,32,3,0,"_dependencyMap"],[27,46,3,0],[28,2,4,0],[28,6,4,0,"_servicesNotifications"],[28,28,4,0],[28,31,4,0,"require"],[28,38,4,0],[28,39,4,0,"_dependencyMap"],[28,53,4,0],[29,2,18,7],[29,11,18,16,"usePushNotifications"],[29,31,18,36,"usePushNotifications"],[29,32,18,36],[29,34,18,39],[30,4,18,39,"_s"],[30,6,18,39],[31,4,19,2],[31,10,19,8],[32,6,19,10,"user"],[32,10,19,14],[33,6,19,16,"isAuthenticated"],[34,4,19,32],[34,5,19,33],[34,8,19,36],[34,12,19,36,"useAuthStore"],[34,27,19,48],[34,28,19,48,"useAuthStore"],[34,40,19,48],[34,42,19,49],[34,43,19,50],[35,4,20,2],[35,10,20,8],[35,11,20,9,"state"],[35,16,20,14],[35,18,20,16,"setState"],[35,26,20,24],[35,27,20,25],[35,30,20,28],[35,34,20,28,"useState"],[35,40,20,36],[35,41,20,36,"useState"],[35,49,20,36],[35,51,20,60],[36,6,21,4,"expoPushToken"],[36,19,21,17],[36,21,21,19],[36,25,21,23],[37,6,22,4,"notification"],[37,18,22,16],[37,20,22,18],[37,24,22,22],[38,6,23,4,"loading"],[38,13,23,11],[38,15,23,13],[38,19,23,17],[39,6,24,4,"error"],[39,11,24,9],[39,13,24,11],[40,4,25,2],[40,5,25,3],[40,6,25,4],[41,4,27,2],[41,10,27,8,"notificationListener"],[41,30,27,28],[41,33,27,31],[41,37,27,31,"useRef"],[41,43,27,37],[41,44,27,37,"useRef"],[41,50,27,37],[41,52,27,73],[41,56,27,77],[41,57,27,78],[42,4,28,2],[42,10,28,8,"responseListener"],[42,26,28,24],[42,29,28,27],[42,33,28,27,"useRef"],[42,39,28,33],[42,40,28,33,"useRef"],[42,46,28,33],[42,48,28,69],[42,52,28,73],[42,53,28,74],[43,4,30,2],[43,8,30,2,"useEffect"],[43,14,30,11],[43,15,30,11,"useEffect"],[43,24,30,11],[43,26,30,12],[43,32,30,18],[44,6,31,4],[45,6,32,4],[45,10,32,8],[45,11,32,9,"user"],[45,15,32,13],[45,19,32,17],[45,20,32,18,"isAuthenticated"],[45,35,32,33],[45,37,32,35],[46,8,33,6,"setState"],[46,16,33,14],[46,17,33,15,"prev"],[46,21,33,19],[46,26,33,24],[47,10,33,26],[47,13,33,29,"prev"],[47,17,33,33],[48,10,33,35,"loading"],[48,17,33,42],[48,19,33,44],[49,8,33,50],[49,9,33,51],[49,10,33,52],[49,11,33,53],[50,8,34,6],[51,6,35,4],[52,6,37,4],[52,12,37,10,"setupNotifications"],[52,30,37,28],[52,33,37,31],[52,39,37,31,"setupNotifications"],[52,40,37,31],[52,45,37,43],[53,8,38,6],[53,12,38,10],[54,10,39,8],[55,10,40,8],[55,16,40,14,"token"],[55,21,40,19],[55,24,40,22],[55,30,40,28],[55,34,40,28,"registerForPushNotificationsAsync"],[55,56,40,61],[55,57,40,61,"registerForPushNotificationsAsync"],[55,90,40,61],[55,92,40,62],[55,93,40,63],[56,10,42,8],[56,14,42,12,"token"],[56,19,42,17],[56,21,42,19],[57,12,43,10,"setState"],[57,20,43,18],[57,21,43,19,"prev"],[57,25,43,23],[57,30,43,28],[58,14,43,30],[58,17,43,33,"prev"],[58,21,43,37],[59,14,43,39,"expoPushToken"],[59,27,43,52],[59,29,43,54,"token"],[60,12,43,60],[60,13,43,61],[60,14,43,62],[60,15,43,63],[62,12,45,10],[63,12,46,10],[63,18,46,16],[63,22,46,16,"registerPushToken"],[63,44,46,33],[63,45,46,33,"registerPushToken"],[63,62,46,33],[63,64,46,34,"token"],[63,69,46,39],[63,70,46,40],[64,10,47,8],[65,10,49,8,"setState"],[65,18,49,16],[65,19,49,17,"prev"],[65,23,49,21],[65,28,49,26],[66,12,49,28],[66,15,49,31,"prev"],[66,19,49,35],[67,12,49,37,"loading"],[67,19,49,44],[67,21,49,46],[68,10,49,52],[68,11,49,53],[68,12,49,54],[68,13,49,55],[69,8,50,6],[69,9,50,7],[69,10,50,8],[69,17,50,15,"error"],[69,22,50,20],[69,24,50,22],[70,10,51,8,"console"],[70,17,51,15],[70,18,51,16,"error"],[70,23,51,21],[70,24,51,22],[70,57,51,55],[70,59,51,57,"error"],[70,64,51,62],[70,65,51,63],[71,10,52,8,"setState"],[71,18,52,16],[71,19,52,17,"prev"],[71,23,52,21],[71,28,52,26],[72,12,53,10],[72,15,53,13,"prev"],[72,19,53,17],[73,12,54,10,"error"],[73,17,54,15],[73,19,54,17,"error"],[73,24,54,22],[73,36,54,34,"Error"],[73,41,54,39],[73,44,54,42,"error"],[73,49,54,47],[73,50,54,48,"message"],[73,57,54,55],[73,60,54,58],[73,75,54,73],[74,12,55,10,"loading"],[74,19,55,17],[74,21,55,19],[75,10,56,8],[75,11,56,9],[75,12,56,10],[75,13,56,11],[76,8,57,6],[77,6,58,4],[77,7,58,5],[78,6,60,4,"setupNotifications"],[78,24,60,22],[78,25,60,23],[78,26,60,24],[80,6,62,4],[81,6,63,4,"notificationListener"],[81,26,63,24],[81,27,63,25,"current"],[81,34,63,32],[81,37,63,35,"Notifications"],[81,50,63,48],[81,51,63,49,"addNotificationReceivedListener"],[81,82,63,80],[81,83,64,7,"notification"],[81,95,64,19],[81,99,64,24],[82,8,65,8,"console"],[82,15,65,15],[82,16,65,16,"log"],[82,19,65,19],[82,20,65,20],[82,44,65,44],[82,46,65,46,"notification"],[82,58,65,58],[82,59,65,59],[83,8,66,8,"setState"],[83,16,66,16],[83,17,66,17,"prev"],[83,21,66,21],[83,26,66,26],[84,10,66,28],[84,13,66,31,"prev"],[84,17,66,35],[85,10,66,37,"notification"],[86,8,66,50],[86,9,66,51],[86,10,66,52],[86,11,66,53],[87,6,67,6],[87,7,68,4],[87,8,68,5],[89,6,70,4],[90,6,71,4,"responseListener"],[90,22,71,20],[90,23,71,21,"current"],[90,30,71,28],[90,33,71,31,"Notifications"],[90,46,71,44],[90,47,71,45,"addNotificationResponseReceivedListener"],[90,86,71,84],[90,87,72,7,"response"],[90,95,72,15],[90,99,72,20],[91,8,73,8],[91,12,73,8,"handleNotificationResponse"],[91,34,73,34],[91,35,73,34,"handleNotificationResponse"],[91,61,73,34],[91,63,73,35,"response"],[91,71,73,43],[91,72,73,44],[92,6,74,6],[92,7,75,4],[92,8,75,5],[93,6,77,4],[93,13,77,11],[93,19,77,17],[94,8,78,6,"notificationListener"],[94,28,78,26],[94,29,78,27,"current"],[94,36,78,34],[94,38,78,36,"remove"],[94,44,78,42],[94,45,78,43],[94,46,78,44],[95,8,79,6,"responseListener"],[95,24,79,22],[95,25,79,23,"current"],[95,32,79,30],[95,34,79,32,"remove"],[95,40,79,38],[95,41,79,39],[95,42,79,40],[96,6,80,4],[96,7,80,5],[97,4,81,2],[97,5,81,3],[97,7,81,5],[97,8,81,6,"user"],[97,12,81,10],[97,14,81,12,"isAuthenticated"],[97,29,81,27],[97,30,81,28],[97,31,81,29],[99,4,83,2],[100,4,84,2],[100,10,84,8,"cleanup"],[100,17,84,15],[100,20,84,18],[100,26,84,18,"cleanup"],[100,27,84,18],[100,32,84,30],[101,6,85,4],[101,10,85,8],[102,8,86,6],[102,14,86,12],[102,18,86,12,"unregisterPushToken"],[102,40,86,31],[102,41,86,31,"unregisterPushToken"],[102,60,86,31],[102,62,86,32],[102,63,86,33],[103,8,87,6,"setState"],[103,16,87,14],[103,17,87,15],[104,10,88,8,"expoPushToken"],[104,23,88,21],[104,25,88,23],[104,29,88,27],[105,10,89,8,"notification"],[105,22,89,20],[105,24,89,22],[105,28,89,26],[106,10,90,8,"loading"],[106,17,90,15],[106,19,90,17],[106,24,90,22],[107,10,91,8,"error"],[107,15,91,13],[107,17,91,15],[108,8,92,6],[108,9,92,7],[108,10,92,8],[109,6,93,4],[109,7,93,5],[109,8,93,6],[109,15,93,13,"error"],[109,20,93,18],[109,22,93,20],[110,8,94,6,"console"],[110,15,94,13],[110,16,94,14,"error"],[110,21,94,19],[110,22,94,20],[110,56,94,54],[110,58,94,56,"error"],[110,63,94,61],[110,64,94,62],[111,6,95,4],[112,4,96,2],[112,5,96,3],[113,4,98,2],[113,11,98,9],[114,6,99,4],[114,9,99,7,"state"],[114,14,99,12],[115,6,100,4,"cleanup"],[116,4,101,2],[116,5,101,3],[117,2,102,0],[118,2,102,1,"_s"],[118,4,102,1],[118,5,18,16,"usePushNotifications"],[118,25,18,36],[119,4,18,36],[119,12,19,36,"useAuthStore"],[119,27,19,48],[119,28,19,48,"useAuthStore"],[119,40,19,48],[120,2,19,48],[121,0,19,48],[121,3]],"functionMap":{"names":["<global>","usePushNotifications","useEffect$argument_0","setState$argument_0","setupNotifications","Notifications.addNotificationReceivedListener$argument_0","Notifications.addNotificationResponseReceivedListener$argument_0","<anonymous>","cleanup"],"mappings":"AAA;OCiB;YCY;eCG,qCD;+BEI;mBDM,2CC;iBDM,qCC;iBDG;UCI;KFE;MGM;iBFE,mCE;OHC;MIK;OJE;WKG;KLG;GDC;kBOG;GPY;CDM"},"hasCjsExports":false},"type":"js/module"}]}