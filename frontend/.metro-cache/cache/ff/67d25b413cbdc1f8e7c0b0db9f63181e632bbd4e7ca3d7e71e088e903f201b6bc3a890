{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":52,"index":105}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"../store/authStore","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":106},"end":{"line":3,"column":50,"index":156}}],"key":"/4BDl/hqolvw7T4CXD8jWAtZK4M=","exportNames":["*"],"imports":1}},{"name":"../services/notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":157},"end":{"line":9,"column":35,"index":312}}],"key":"PilFUkBfYpg1cVGLNRiWDw/oULQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  exports.usePushNotifications = usePushNotifications;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _expoNotifications = require(_dependencyMap[1], \"expo-notifications\");\n  var Notifications = _interopNamespace(_expoNotifications);\n  var _storeAuthStore = require(_dependencyMap[2], \"../store/authStore\");\n  var _servicesNotifications = require(_dependencyMap[3], \"../services/notifications\");\n  function usePushNotifications() {\n    _s();\n    const {\n      user,\n      isAuthenticated\n    } = (0, _storeAuthStore.useAuthStore)();\n    const [state, setState] = (0, _react.useState)({\n      expoPushToken: null,\n      notification: null,\n      loading: true,\n      error: null\n    });\n    const notificationListener = (0, _react.useRef)(null);\n    const responseListener = (0, _react.useRef)(null);\n    (0, _react.useEffect)(() => {\n      // Only register if user is logged in\n      if (!user || !isAuthenticated) {\n        setState(prev => Object.assign({}, prev, {\n          loading: false\n        }));\n        return;\n      }\n      const setupNotifications = async () => {\n        try {\n          // Register for push notifications\n          const token = await (0, _servicesNotifications.registerForPushNotificationsAsync)();\n          if (token) {\n            setState(prev => Object.assign({}, prev, {\n              expoPushToken: token\n            }));\n\n            // Register token with backend\n            await (0, _servicesNotifications.registerPushToken)(token);\n          }\n          setState(prev => Object.assign({}, prev, {\n            loading: false\n          }));\n        } catch (error) {\n          console.error('Error setting up notifications:', error);\n          setState(prev => Object.assign({}, prev, {\n            error: error instanceof Error ? error.message : 'Unknown error',\n            loading: false\n          }));\n        }\n      };\n      setupNotifications();\n\n      // Listen for incoming notifications when app is in foreground\n      notificationListener.current = Notifications.addNotificationReceivedListener(notification => {\n        console.log('Notification received:', notification);\n        setState(prev => Object.assign({}, prev, {\n          notification\n        }));\n      });\n\n      // Listen for notification responses (when user taps notification)\n      responseListener.current = Notifications.addNotificationResponseReceivedListener(response => {\n        (0, _servicesNotifications.handleNotificationResponse)(response);\n      });\n      return () => {\n        notificationListener.current?.remove();\n        responseListener.current?.remove();\n      };\n    }, [user, isAuthenticated]);\n\n    // Cleanup on logout\n    const cleanup = async () => {\n      try {\n        await (0, _servicesNotifications.unregisterPushToken)();\n        setState({\n          expoPushToken: null,\n          notification: null,\n          loading: false,\n          error: null\n        });\n      } catch (error) {\n        console.error('Error cleaning up notifications:', error);\n      }\n    };\n    return Object.assign({}, state, {\n      cleanup\n    });\n  }\n  _s(usePushNotifications, \"dZ4yWeGuIjl/unq3KSdDBRrQ2ro=\", false, function () {\n    return [_storeAuthStore.useAuthStore];\n  });\n});","lineCount":115,"map":[[23,2,18,0,"exports"],[23,9,18,0],[23,10,18,0,"usePushNotifications"],[23,30,18,0],[23,33,18,0,"usePushNotifications"],[23,53,18,0],[24,2,1,0],[24,6,1,0,"_react"],[24,12,1,0],[24,15,1,0,"require"],[24,22,1,0],[24,23,1,0,"_dependencyMap"],[24,37,1,0],[25,2,2,0],[25,6,2,0,"_expoNotifications"],[25,24,2,0],[25,27,2,0,"require"],[25,34,2,0],[25,35,2,0,"_dependencyMap"],[25,49,2,0],[26,2,2,0],[26,6,2,0,"Notifications"],[26,19,2,0],[26,22,2,0,"_interopNamespace"],[26,39,2,0],[26,40,2,0,"_expoNotifications"],[26,58,2,0],[27,2,3,0],[27,6,3,0,"_storeAuthStore"],[27,21,3,0],[27,24,3,0,"require"],[27,31,3,0],[27,32,3,0,"_dependencyMap"],[27,46,3,0],[28,2,4,0],[28,6,4,0,"_servicesNotifications"],[28,28,4,0],[28,31,4,0,"require"],[28,38,4,0],[28,39,4,0,"_dependencyMap"],[28,53,4,0],[29,2,18,7],[29,11,18,16,"usePushNotifications"],[29,31,18,36,"usePushNotifications"],[29,32,18,36],[29,34,18,39],[30,4,18,39,"_s"],[30,6,18,39],[31,4,19,2],[31,10,19,8],[32,6,19,10,"user"],[32,10,19,14],[33,6,19,16,"isAuthenticated"],[34,4,19,32],[34,5,19,33],[34,8,19,36],[34,12,19,36,"useAuthStore"],[34,27,19,48],[34,28,19,48,"useAuthStore"],[34,40,19,48],[34,42,19,49],[34,43,19,50],[35,4,20,2],[35,10,20,8],[35,11,20,9,"state"],[35,16,20,14],[35,18,20,16,"setState"],[35,26,20,24],[35,27,20,25],[35,30,20,28],[35,34,20,28,"useState"],[35,40,20,36],[35,41,20,36,"useState"],[35,49,20,36],[35,51,20,60],[36,6,21,4,"expoPushToken"],[36,19,21,17],[36,21,21,19],[36,25,21,23],[37,6,22,4,"notification"],[37,18,22,16],[37,20,22,18],[37,24,22,22],[38,6,23,4,"loading"],[38,13,23,11],[38,15,23,13],[38,19,23,17],[39,6,24,4,"error"],[39,11,24,9],[39,13,24,11],[40,4,25,2],[40,5,25,3],[40,6,25,4],[41,4,27,2],[41,10,27,8,"notificationListener"],[41,30,27,28],[41,33,27,31],[41,37,27,31,"useRef"],[41,43,27,37],[41,44,27,37,"useRef"],[41,50,27,37],[41,52,27,73],[41,56,27,77],[41,57,27,78],[42,4,28,2],[42,10,28,8,"responseListener"],[42,26,28,24],[42,29,28,27],[42,33,28,27,"useRef"],[42,39,28,33],[42,40,28,33,"useRef"],[42,46,28,33],[42,48,28,69],[42,52,28,73],[42,53,28,74],[43,4,30,2],[43,8,30,2,"useEffect"],[43,14,30,11],[43,15,30,11,"useEffect"],[43,24,30,11],[43,26,30,12],[43,32,30,18],[44,6,31,4],[45,6,32,4],[45,10,32,8],[45,11,32,9,"user"],[45,15,32,13],[45,19,32,17],[45,20,32,18,"isAuthenticated"],[45,35,32,33],[45,37,32,35],[46,8,33,6,"setState"],[46,16,33,14],[46,17,33,15,"prev"],[46,21,33,19],[46,25,33,19,"Object"],[46,31,33,19],[46,32,33,19,"assign"],[46,38,33,19],[46,43,33,29,"prev"],[46,47,33,33],[47,10,33,35,"loading"],[47,17,33,42],[47,19,33,44],[48,8,33,49],[48,10,33,52],[48,11,33,53],[49,8,34,6],[50,6,35,4],[51,6,37,4],[51,12,37,10,"setupNotifications"],[51,30,37,28],[51,33,37,31],[51,39,37,31,"setupNotifications"],[51,40,37,31],[51,45,37,43],[52,8,38,6],[52,12,38,10],[53,10,39,8],[54,10,40,8],[54,16,40,14,"token"],[54,21,40,19],[54,24,40,22],[54,30,40,28],[54,34,40,28,"registerForPushNotificationsAsync"],[54,56,40,61],[54,57,40,61,"registerForPushNotificationsAsync"],[54,90,40,61],[54,92,40,62],[54,93,40,63],[55,10,42,8],[55,14,42,12,"token"],[55,19,42,17],[55,21,42,19],[56,12,43,10,"setState"],[56,20,43,18],[56,21,43,19,"prev"],[56,25,43,23],[56,29,43,23,"Object"],[56,35,43,23],[56,36,43,23,"assign"],[56,42,43,23],[56,47,43,33,"prev"],[56,51,43,37],[57,14,43,39,"expoPushToken"],[57,27,43,52],[57,29,43,54,"token"],[58,12,43,59],[58,14,43,62],[58,15,43,63],[60,12,45,10],[61,12,46,10],[61,18,46,16],[61,22,46,16,"registerPushToken"],[61,44,46,33],[61,45,46,33,"registerPushToken"],[61,62,46,33],[61,64,46,34,"token"],[61,69,46,39],[61,70,46,40],[62,10,47,8],[63,10,49,8,"setState"],[63,18,49,16],[63,19,49,17,"prev"],[63,23,49,21],[63,27,49,21,"Object"],[63,33,49,21],[63,34,49,21,"assign"],[63,40,49,21],[63,45,49,31,"prev"],[63,49,49,35],[64,12,49,37,"loading"],[64,19,49,44],[64,21,49,46],[65,10,49,51],[65,12,49,54],[65,13,49,55],[66,8,50,6],[66,9,50,7],[66,10,50,8],[66,17,50,15,"error"],[66,22,50,20],[66,24,50,22],[67,10,51,8,"console"],[67,17,51,15],[67,18,51,16,"error"],[67,23,51,21],[67,24,51,22],[67,57,51,55],[67,59,51,57,"error"],[67,64,51,62],[67,65,51,63],[68,10,52,8,"setState"],[68,18,52,16],[68,19,52,17,"prev"],[68,23,52,21],[68,27,52,21,"Object"],[68,33,52,21],[68,34,52,21,"assign"],[68,40,52,21],[68,45,53,13,"prev"],[68,49,53,17],[69,12,54,10,"error"],[69,17,54,15],[69,19,54,17,"error"],[69,24,54,22],[69,36,54,34,"Error"],[69,41,54,39],[69,44,54,42,"error"],[69,49,54,47],[69,50,54,48,"message"],[69,57,54,55],[69,60,54,58],[69,75,54,73],[70,12,55,10,"loading"],[70,19,55,17],[70,21,55,19],[71,10,55,24],[71,12,56,10],[71,13,56,11],[72,8,57,6],[73,6,58,4],[73,7,58,5],[74,6,60,4,"setupNotifications"],[74,24,60,22],[74,25,60,23],[74,26,60,24],[76,6,62,4],[77,6,63,4,"notificationListener"],[77,26,63,24],[77,27,63,25,"current"],[77,34,63,32],[77,37,63,35,"Notifications"],[77,50,63,48],[77,51,63,49,"addNotificationReceivedListener"],[77,82,63,80],[77,83,64,7,"notification"],[77,95,64,19],[77,99,64,24],[78,8,65,8,"console"],[78,15,65,15],[78,16,65,16,"log"],[78,19,65,19],[78,20,65,20],[78,44,65,44],[78,46,65,46,"notification"],[78,58,65,58],[78,59,65,59],[79,8,66,8,"setState"],[79,16,66,16],[79,17,66,17,"prev"],[79,21,66,21],[79,25,66,21,"Object"],[79,31,66,21],[79,32,66,21,"assign"],[79,38,66,21],[79,43,66,31,"prev"],[79,47,66,35],[80,10,66,37,"notification"],[81,8,66,49],[81,10,66,52],[81,11,66,53],[82,6,67,6],[82,7,68,4],[82,8,68,5],[84,6,70,4],[85,6,71,4,"responseListener"],[85,22,71,20],[85,23,71,21,"current"],[85,30,71,28],[85,33,71,31,"Notifications"],[85,46,71,44],[85,47,71,45,"addNotificationResponseReceivedListener"],[85,86,71,84],[85,87,72,7,"response"],[85,95,72,15],[85,99,72,20],[86,8,73,8],[86,12,73,8,"handleNotificationResponse"],[86,34,73,34],[86,35,73,34,"handleNotificationResponse"],[86,61,73,34],[86,63,73,35,"response"],[86,71,73,43],[86,72,73,44],[87,6,74,6],[87,7,75,4],[87,8,75,5],[88,6,77,4],[88,13,77,11],[88,19,77,17],[89,8,78,6,"notificationListener"],[89,28,78,26],[89,29,78,27,"current"],[89,36,78,34],[89,38,78,36,"remove"],[89,44,78,42],[89,45,78,43],[89,46,78,44],[90,8,79,6,"responseListener"],[90,24,79,22],[90,25,79,23,"current"],[90,32,79,30],[90,34,79,32,"remove"],[90,40,79,38],[90,41,79,39],[90,42,79,40],[91,6,80,4],[91,7,80,5],[92,4,81,2],[92,5,81,3],[92,7,81,5],[92,8,81,6,"user"],[92,12,81,10],[92,14,81,12,"isAuthenticated"],[92,29,81,27],[92,30,81,28],[92,31,81,29],[94,4,83,2],[95,4,84,2],[95,10,84,8,"cleanup"],[95,17,84,15],[95,20,84,18],[95,26,84,18,"cleanup"],[95,27,84,18],[95,32,84,30],[96,6,85,4],[96,10,85,8],[97,8,86,6],[97,14,86,12],[97,18,86,12,"unregisterPushToken"],[97,40,86,31],[97,41,86,31,"unregisterPushToken"],[97,60,86,31],[97,62,86,32],[97,63,86,33],[98,8,87,6,"setState"],[98,16,87,14],[98,17,87,15],[99,10,88,8,"expoPushToken"],[99,23,88,21],[99,25,88,23],[99,29,88,27],[100,10,89,8,"notification"],[100,22,89,20],[100,24,89,22],[100,28,89,26],[101,10,90,8,"loading"],[101,17,90,15],[101,19,90,17],[101,24,90,22],[102,10,91,8,"error"],[102,15,91,13],[102,17,91,15],[103,8,92,6],[103,9,92,7],[103,10,92,8],[104,6,93,4],[104,7,93,5],[104,8,93,6],[104,15,93,13,"error"],[104,20,93,18],[104,22,93,20],[105,8,94,6,"console"],[105,15,94,13],[105,16,94,14,"error"],[105,21,94,19],[105,22,94,20],[105,56,94,54],[105,58,94,56,"error"],[105,63,94,61],[105,64,94,62],[106,6,95,4],[107,4,96,2],[107,5,96,3],[108,4,98,2],[108,11,98,2,"Object"],[108,17,98,2],[108,18,98,2,"assign"],[108,24,98,2],[108,29,99,7,"state"],[108,34,99,12],[109,6,100,4,"cleanup"],[110,4,100,11],[111,2,102,0],[112,2,102,1,"_s"],[112,4,102,1],[112,5,18,16,"usePushNotifications"],[112,25,18,36],[113,4,18,36],[113,12,19,36,"useAuthStore"],[113,27,19,48],[113,28,19,48,"useAuthStore"],[113,40,19,48],[114,2,19,48],[115,0,19,48],[115,3]],"functionMap":{"names":["<global>","usePushNotifications","useEffect$argument_0","setState$argument_0","setupNotifications","Notifications.addNotificationReceivedListener$argument_0","Notifications.addNotificationResponseReceivedListener$argument_0","<anonymous>","cleanup"],"mappings":"AAA;OCiB;YCY;eCG,qCD;+BEI;mBDM,2CC;iBDM,qCC;iBDG;UCI;KFE;MGM;iBFE,mCE;OHC;MIK;OJE;WKG;KLG;GDC;kBOG;GPY;CDM"},"hasCjsExports":false},"type":"js/module"}]}